# ğŸ” Project 2: Automated Vulnerability Management Pipeline

[![GitHub Actions](https://img.shields.io/badge/GitHub_Actions-2088FF?style=flat-square&logo=github-actions&logoColor=white)](https://github.com/features/actions)
[![Docker](https://img.shields.io/badge/Docker-2496ED?style=flat-square&logo=docker&logoColor=white)](https://www.docker.com/)
[![Terraform](https://img.shields.io/badge/Terraform-7B42BC?style=flat-square&logo=terraform&logoColor=white)](https://www.terraform.io/)
[![Trivy](https://img.shields.io/badge/Trivy-1904DA?style=flat-square&logo=aqua&logoColor=white)](https://trivy.dev/)

> **A DevSecOps CI/CD pipeline that automatically scans for security vulnerabilities and enforces security gates before deployment.**

---

## ğŸ“‹ Table of Contents

- [Overview](#-overview)
- [Pipeline Architecture](#-pipeline-architecture)
- [Security Scanning Tools](#-security-scanning-tools)
- [Features](#-features)
- [Prerequisites](#-prerequisites)
- [Quick Start](#-quick-start)
- [Pipeline Stages](#-pipeline-stages)
- [Security Gates](#-security-gates)
- [Viewing Results](#-viewing-results)
- [Customization](#-customization)
- [Sample Vulnerabilities](#-sample-vulnerabilities)
- [Lessons Learned](#-lessons-learned)
- [Future Improvements](#-future-improvements)

---

## ğŸ¯ Overview

### What This Project Does

This project implements a **"shift-left" security approach** by integrating security scanning directly into the CI/CD pipeline. Every code change is automatically scanned for:

1. **Hardcoded Secrets** - API keys, passwords, tokens accidentally committed
2. **Infrastructure Misconfigurations** - Insecure Terraform/CloudFormation settings
3. **Container Vulnerabilities** - CVEs in Docker images and dependencies
4. **Dependency Vulnerabilities** - Known vulnerabilities in packages

### Why This Matters

In traditional development, security testing happens late in the cycle (or not at all). This leads to:
- Expensive fixes late in development
- Security issues reaching production
- Slow security feedback loops

**DevSecOps** moves security left, catching issues when they're cheapest to fix - at commit time.

### Skills Demonstrated

| Skill Category | Technologies |
|----------------|--------------|
| CI/CD | GitHub Actions, Pipeline Design |
| Container Security | Docker, Trivy, Image Scanning |
| IaC Security | tfsec, Checkov, Terraform |
| Secret Detection | Gitleaks, TruffleHog |
| Cloud Services | AWS ECR, S3, SNS |

---

## ğŸ—ï¸ Pipeline Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DEVELOPER WORKFLOW                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Code Commit / Pull Request                                               â”‚
â”‚     â””â”€â”€ Triggers GitHub Actions Pipeline                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       GITHUB ACTIONS PIPELINE                                â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  STAGE 1: SECRET SCANNING                                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚    â”‚
â”‚  â”‚  â”‚  Gitleaks   â”‚ â”€â”€â–º Scan entire repo for secrets                   â”‚    â”‚
â”‚  â”‚  â”‚             â”‚     â€¢ API keys                                     â”‚    â”‚
â”‚  â”‚  â”‚             â”‚     â€¢ Passwords                                    â”‚    â”‚
â”‚  â”‚  â”‚             â”‚     â€¢ Private keys                                 â”‚    â”‚
â”‚  â”‚  â”‚             â”‚     â€¢ Tokens                                       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚    â”‚
â”‚  â”‚         â”‚                                                           â”‚    â”‚
â”‚  â”‚         â–¼                                                           â”‚    â”‚
â”‚  â”‚  ğŸš¦ GATE: Secrets found? â”€â”€â–º YES â”€â”€â–º âŒ FAIL PIPELINE               â”‚    â”‚
â”‚  â”‚                          â””â”€â–º NO  â”€â”€â–º âœ… Continue                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                  â”‚                                           â”‚
â”‚                                  â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  STAGE 2: INFRASTRUCTURE SECURITY                                   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚    â”‚
â”‚  â”‚  â”‚   tfsec     â”‚  â”‚   Checkov   â”‚                                   â”‚    â”‚
â”‚  â”‚  â”‚             â”‚  â”‚             â”‚                                   â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ AWS rules â”‚  â”‚ â€¢ CIS bench â”‚                                   â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ GCP rules â”‚  â”‚ â€¢ Custom    â”‚                                   â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Azure     â”‚  â”‚   policies  â”‚                                   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                   â”‚    â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚    â”‚
â”‚  â”‚                  â–¼                                                  â”‚    â”‚
â”‚  â”‚  ğŸš¦ GATE: Critical/High issues? â”€â”€â–º YES â”€â”€â–º âŒ FAIL PIPELINE        â”‚    â”‚
â”‚  â”‚                                 â””â”€â–º NO  â”€â”€â–º âœ… Continue             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                  â”‚                                           â”‚
â”‚                                  â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  STAGE 3: CONTAINER SECURITY                                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚    â”‚
â”‚  â”‚  â”‚   Docker    â”‚ â”€â”€â–º Build image from Dockerfile                    â”‚    â”‚
â”‚  â”‚  â”‚   Build     â”‚                                                    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚    â”‚
â”‚  â”‚         â”‚                                                           â”‚    â”‚
â”‚  â”‚         â–¼                                                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚    â”‚
â”‚  â”‚  â”‚   Trivy     â”‚ â”€â”€â–º Scan image for CVEs                            â”‚    â”‚
â”‚  â”‚  â”‚             â”‚     â€¢ OS packages                                  â”‚    â”‚
â”‚  â”‚  â”‚             â”‚     â€¢ Application dependencies                     â”‚    â”‚
â”‚  â”‚  â”‚             â”‚     â€¢ Misconfigurations                            â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚    â”‚
â”‚  â”‚         â”‚                                                           â”‚    â”‚
â”‚  â”‚         â–¼                                                           â”‚    â”‚
â”‚  â”‚  ğŸš¦ GATE: Critical CVEs? â”€â”€â–º YES â”€â”€â–º âŒ FAIL PIPELINE               â”‚    â”‚
â”‚  â”‚                          â””â”€â–º NO  â”€â”€â–º âœ… Continue                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                  â”‚                                           â”‚
â”‚                                  â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  STAGE 4: GENERATE REPORTS                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚    â”‚
â”‚  â”‚  â”‚   JSON      â”‚  â”‚    HTML     â”‚  â”‚   SARIF     â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚   Report    â”‚  â”‚   Report    â”‚  â”‚  (GitHub)   â”‚                  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â”‚    â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚    â”‚
â”‚  â”‚                          â”‚                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼                 â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    AWS      â”‚   â”‚   GitHub    â”‚   â”‚    SNS      â”‚
    â”‚    S3       â”‚   â”‚  Security   â”‚   â”‚   Alert     â”‚
    â”‚  (Reports)  â”‚   â”‚    Tab      â”‚   â”‚  (Failures) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ ALL GATES PASS? â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   âœ… SUCCESS    â”‚             â”‚   âŒ FAILURE    â”‚
    â”‚                 â”‚             â”‚                 â”‚
    â”‚  Push to ECR    â”‚             â”‚  Block Deploy   â”‚
    â”‚  Deploy Ready   â”‚             â”‚  Notify Team    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Security Scanning Tools

### Gitleaks - Secret Detection

| Feature | Description |
|---------|-------------|
| **Purpose** | Detect hardcoded secrets in git repositories |
| **Detects** | API keys, passwords, tokens, private keys, certificates |
| **Speed** | Scans entire git history in seconds |
| **Customization** | Custom regex patterns via `.gitleaks.toml` |

**Example Findings:**
```
Finding:     AWS Access Key ID
Secret:      AKIAIOSFODNN7EXAMPLE
File:        config/settings.py
Line:        42
Commit:      a]b1c2d3e4f5
```

---

### tfsec - Terraform Security

| Feature | Description |
|---------|-------------|
| **Purpose** | Static analysis of Terraform code |
| **Checks** | 100+ built-in security rules |
| **Coverage** | AWS, Azure, GCP, General |
| **Output** | Multiple formats (JSON, SARIF, HTML) |

**Example Findings:**
```
Result: Security group allows unrestricted ingress to port 22
Resource: aws_security_group.allow_ssh
Severity: HIGH
Description: Security group allows ingress from 0.0.0.0/0 to port 22 (SSH)
Resolution: Restrict SSH access to specific IP ranges
```

---

### Checkov - IaC Security

| Feature | Description |
|---------|-------------|
| **Purpose** | Policy-as-code for infrastructure |
| **Supports** | Terraform, CloudFormation, Kubernetes, Dockerfile |
| **Benchmarks** | CIS, SOC2, HIPAA compliance checks |
| **Custom Policies** | Python-based custom checks |

---

### Trivy - Container Security

| Feature | Description |
|---------|-------------|
| **Purpose** | Comprehensive container vulnerability scanner |
| **Scans** | OS packages, application dependencies, IaC, secrets |
| **Database** | Updates from NVD, vendor advisories |
| **Speed** | Fast scanning with local cache |

**Example Findings:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Library     â”‚ Vulnerability  â”‚ Severity â”‚         Fixed Version       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ openssl         â”‚ CVE-2023-1234  â”‚ CRITICAL â”‚ 1.1.1t                      â”‚
â”‚ python3.9       â”‚ CVE-2023-5678  â”‚ HIGH     â”‚ 3.9.17                      â”‚
â”‚ requests        â”‚ CVE-2023-9012  â”‚ MEDIUM   â”‚ 2.31.0                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ¨ Features

### ğŸš¦ Security Gates

| Gate | Trigger | Action |
|------|---------|--------|
| Secrets Found | Any secret detected | Block pipeline |
| Critical IaC Issue | tfsec CRITICAL finding | Block pipeline |
| High IaC Issues | > 3 HIGH findings | Block pipeline |
| Critical CVE | CRITICAL vulnerability | Block pipeline |
| High CVEs | > 5 HIGH vulnerabilities | Warning only |

### ğŸ“Š Reporting

- **JSON Reports**: Machine-readable for automation
- **HTML Reports**: Human-readable with details
- **SARIF Output**: GitHub Security tab integration
- **S3 Archive**: Historical report storage
- **Email Alerts**: Immediate notification on failures

### ğŸ”” Notifications

- GitHub Checks status
- Email via SNS
- Slack integration (optional)
- PR comments with summary

---

## ğŸ“‹ Prerequisites

- [ ] GitHub account
- [ ] AWS Account (for ECR, S3, SNS)
- [ ] Docker installed locally (for testing)
- [ ] Terraform installed (for IaC examples)

### GitHub Repository Secrets

Configure these in your repo's Settings > Secrets:

| Secret Name | Description |
|-------------|-------------|
| `AWS_ACCESS_KEY_ID` | AWS access key |
| `AWS_SECRET_ACCESS_KEY` | AWS secret key |
| `AWS_REGION` | AWS region (e.g., us-east-1) |
| `SNS_TOPIC_ARN` | SNS topic for alerts (optional) |

---

## ğŸš€ Quick Start

### 1. Fork/Clone the Repository

```bash
git clone https://github.com/yab2/cloud-portfolio.git
cd cloud-security-portfolio/project-2-vulnerability-pipeline
```

### 2. Configure GitHub Actions

The pipeline is already configured in `.github/workflows/security-pipeline.yml`. 

To enable:
1. Go to your GitHub repo > Settings > Actions
2. Enable "Allow all actions"

### 3. Trigger the Pipeline

```bash
# Make a change and push
git add .
git commit -m "Test security pipeline"
git push origin main

# Or create a Pull Request to see checks
```

### 4. View Results

- **GitHub Actions**: Check the Actions tab for pipeline run
- **Security Tab**: View SARIF results in Security > Code scanning alerts
- **PR Checks**: See inline comments on Pull Requests

---

## ğŸ“š Pipeline Stages

### Stage 1: Secret Scanning

```yaml
secret-scan:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0  # Full history for scanning
    
    - name: Run Gitleaks
      uses: gitleaks/gitleaks-action@v2
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

**Customization** - `.gitleaks.toml`:
```toml
[extend]
useDefault = true

[[rules]]
description = "Custom API Key Pattern"
regex = '''my-api-key-[a-zA-Z0-9]{32}'''
tags = ["key", "custom"]
```

---

### Stage 2: Infrastructure Scanning

```yaml
iac-scan:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    
    - name: tfsec
      uses: aquasecurity/tfsec-action@v1.0.0
      with:
        soft_fail: false
        
    - name: Checkov
      uses: bridgecrewio/checkov-action@v12
      with:
        directory: terraform/
        framework: terraform
```

---

### Stage 3: Container Scanning

```yaml
container-scan:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    
    - name: Build Docker Image
      run: docker build -t app:${{ github.sha }} .
    
    - name: Run Trivy
      uses: aquasecurity/trivy-action@master
      with:
        image-ref: 'app:${{ github.sha }}'
        severity: 'CRITICAL,HIGH'
        exit-code: '1'
```

---

### Stage 4: Report Generation

```yaml
generate-reports:
  runs-on: ubuntu-latest
  needs: [secret-scan, iac-scan, container-scan]
  steps:
    - name: Upload to S3
      run: |
        aws s3 cp reports/ s3://$BUCKET/reports/${{ github.sha }}/ --recursive
    
    - name: Upload SARIF
      uses: github/codeql-action/upload-sarif@v2
      with:
        sarif_file: trivy-results.sarif
```

---

## ğŸš¦ Security Gates

### Configuring Gate Thresholds

Edit `.github/workflows/security-pipeline.yml`:

```yaml
env:
  # Secret scanning
  FAIL_ON_SECRETS: true
  
  # IaC scanning
  TFSEC_SEVERITY: "CRITICAL,HIGH"
  CHECKOV_SOFT_FAIL: false
  
  # Container scanning
  TRIVY_SEVERITY: "CRITICAL"
  TRIVY_EXIT_CODE: 1
  MAX_HIGH_VULNS: 5
```

### Gate Logic

```
IF secrets_found:
    FAIL immediately
    
IF tfsec_critical > 0 OR tfsec_high > 3:
    FAIL pipeline
    
IF trivy_critical > 0:
    FAIL pipeline
ELIF trivy_high > MAX_HIGH_VULNS:
    WARN but continue
    
IF all_gates_pass:
    ALLOW deployment
```

---

## ğŸ“Š Viewing Results

### GitHub Actions

1. Navigate to **Actions** tab
2. Click on workflow run
3. Expand each job to see logs
4. Download artifacts for full reports

### GitHub Security Tab

1. Navigate to **Security** tab
2. Click **Code scanning alerts**
3. View findings organized by severity
4. Track remediation status

### S3 Reports

```bash
# List reports
aws s3 ls s3://your-bucket/reports/

# Download specific report
aws s3 cp s3://your-bucket/reports/<commit-sha>/trivy-report.html .
```

---

## âš™ï¸ Customization

### Adding Custom Secret Patterns

`.gitleaks.toml`:
```toml
[[rules]]
id = "my-company-api-key"
description = "MyCompany API Key"
regex = '''MYCO_[A-Z0-9]{32}'''
tags = ["api-key", "mycompany"]
```

### Adding Custom Checkov Policies

`custom_policies/my_check.py`:
```python
from checkov.terraform.checks.resource.base_resource_check import BaseResourceCheck

class MyCustomCheck(BaseResourceCheck):
    def __init__(self):
        name = "Ensure my custom requirement is met"
        id = "CKV_CUSTOM_1"
        supported_resources = ['aws_s3_bucket']
        super().__init__(name=name, id=id, ...)
```

### Ignoring Known Issues

**tfsec inline ignore:**
```hcl
resource "aws_security_group" "example" {
  #tfsec:ignore:aws-ec2-no-public-ingress-sgr
  ingress {
    ...
  }
}
```

**Checkov skip:**
```hcl
resource "aws_s3_bucket" "example" {
  #checkov:skip=CKV_AWS_18:Access logging not required for this bucket
  bucket = "my-bucket"
}
```

---

## ğŸ§ª Sample Vulnerabilities

### Intentionally Vulnerable Examples

The `app/vulnerable/` directory contains intentional vulnerabilities for testing:

```python
# DO NOT USE IN PRODUCTION
# These are for testing the scanner

# Hardcoded secret (Gitleaks will catch)
API_KEY = "AKIAIOSFODNN7EXAMPLE"

# SQL Injection vulnerable (for demo)
query = f"SELECT * FROM users WHERE id = {user_input}"
```

### Testing the Pipeline

```bash
# Add a fake secret to trigger Gitleaks
echo "aws_secret_access_key = wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLE" >> test.txt
git add test.txt
git commit -m "Test secret detection"
git push

# Check pipeline - should fail at secret scanning stage
```

---

## ğŸ“ Lessons Learned

### Technical Insights

1. **Pipeline Speed**: Caching Docker layers and tool databases significantly improves run time.

2. **False Positives**: Initial runs had many false positives. Tuning rules and adding ignores was essential.

3. **SARIF Integration**: GitHub's security tab is powerful but requires proper SARIF formatting.

### DevSecOps Insights

1. **Developer Experience**: Too many failures frustrate developers. Start with warnings, then enforce.

2. **Baseline First**: Establish a baseline of existing issues before blocking new ones.

3. **Incremental Adoption**: Roll out scanning tool by tool, not all at once.

---

## ğŸ”® Future Improvements

### Short-term

- [ ] Add DAST (Dynamic Application Security Testing)
- [ ] Integrate Dependabot for dependency updates
- [ ] Add SonarQube for code quality
- [ ] Implement branch protection rules

### Long-term

- [ ] ML-based false positive reduction
- [ ] Integration with vulnerability management platform
- [ ] Automated remediation PRs
- [ ] Compliance report generation

---

## ğŸ“‚ Project Structure

```
project-2-vulnerability-pipeline/
â”œâ”€â”€ README.md                    # This file
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ security-pipeline.yml  # Main pipeline
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Dockerfile              # Sample app Dockerfile
â”‚   â”œâ”€â”€ app.py                  # Sample application
â”‚   â”œâ”€â”€ requirements.txt        # Python dependencies
â”‚   â””â”€â”€ vulnerable/             # Intentional vulns for testing
â”œâ”€â”€ terraform/
â”‚   â”œâ”€â”€ main.tf                 # Sample infrastructure
â”‚   â”œâ”€â”€ variables.tf
â”‚   â””â”€â”€ insecure/               # Intentionally insecure for testing
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ .gitleaks.toml          # Gitleaks configuration
â”‚   â”œâ”€â”€ .trivyignore            # Trivy ignore rules
â”‚   â””â”€â”€ checkov_config.yml      # Checkov configuration
â”œâ”€â”€ custom_policies/            # Custom Checkov policies
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ pipeline-architecture.png
â”‚   â””â”€â”€ sample-report.png
â””â”€â”€ scripts/
    â””â”€â”€ local-scan.sh           # Run scans locally
```

---

## ğŸ¤ Contributing

Contributions welcome! Areas of interest:
- Additional scanning tools
- Custom policies
- Documentation improvements
- Bug fixes

---

## ğŸ“„ License

MIT License - see [LICENSE](../LICENSE)

---

<p align="center">
  <b>Part of the <a href="../README.md">Cloud Security Portfolio</a></b>
</p>

<p align="center">
  <i>"Shift left - catch bugs when they're cheapest to fix."</i>
</p>
